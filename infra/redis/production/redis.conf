# Redis Rate Limiting Configuration - PRODUCTION
# Language Quiz Service - Ephemeral rate limit counter storage

# Network settings
# Bind to both IPv4 and IPv6 for Fly.io private networking (uses IPv6)
bind 0.0.0.0 ::
protected-mode yes
port 6379
tcp-backlog 511
timeout 300
tcp-keepalive 60

# Memory management - limit for production
maxmemory 64mb
# Evict any key using LRU when memory limit reached
maxmemory-policy allkeys-lru
# Sample 10 keys for more accurate LRU eviction
maxmemory-samples 10

# Disable persistence - rate limits are ephemeral
# No RDB snapshots
save ""
# No AOF logging
appendonly no

# Performance optimization
# Single database for rate limiting
databases 1
# Disable keyspace notifications to save CPU
notify-keyspace-events ""

# Rate limiting optimizations
hz 10
# Aggressive timeout for slow operations
slowlog-log-slower-than 10000
slowlog-max-len 128

# Client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# Threading (Redis 6+)
io-threads 2
io-threads-do-reads yes

# Security
# Password will be set via command line argument

# Logging - production level
loglevel warning
logfile ""

# Process
daemonize no
supervised no
pidfile /var/run/redis.pid

# Memory efficiency for rate limit keys
hash-max-ziplist-entries 64
hash-max-ziplist-value 512
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 64
zset-max-ziplist-entries 64
zset-max-ziplist-value 32
hll-sparse-max-bytes 3000

# Production security - disable dangerous commands
rename-command FLUSHALL ""
rename-command FLUSHDB ""
rename-command CONFIG ""
rename-command DEBUG ""
